FROM eclipse-temurin:17-jdk-alpine AS builder

WORKDIR /app

RUN apk update && apk add --no-cache bash git ca-certificates maven

COPY pom.xml .
COPY src ./src

# Build the application with Maven
RUN mvn -f pom.xml clean package

FROM eclipse-temurin:17-jre-alpine
ENV JWT_PUBLIC_KEY="MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAtn6/0H2aWyEoiGx4srEPFMZ1bkijgiE/UHeW8Y0S7oJ9vuElsoL6YTHg/VkU45ncd/LGP/XEGVNoCnI+wbktypliZttaJ1Zt9sViKaLHqbe8BtLGiY4zo7QQ5bEQTwFEw0+b/CEzDZ43huoYSdY+sRTiR5yv/XXdU6whpgqg8VaoQDXK/Ey3GRiRhITRmDgnnteFNiiaKrgCOFAfoc2oaXFjk6hima9v5bSpP2pYigUzvzFME4l7hnQxfg7a37DMf54dOQhVCSSrBTg1EXwHVZHGt5lSIempWKR5nU6Y77I4OZqUvi9xm8ZH+iNMedb966d5goLD9mvAaJXpnPbJzQIDAQAB"
ENV JWT_PRIVATE_KEY="MIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQC2fr/QfZpbISiIbHiysQ8UxnVuSKOCIT9Qd5bxjRLugn2+4SWygvphMeD9WRTjmdx38sY/9cQZU2gKcj7BuS3KmWJm21onVm32xWIposept7wG0saJjjOjtBDlsRBPAUTDT5v8ITMNnjeG6hhJ1j6xFOJHnK/9dd1TrCGmCqDxVqhANcr8TLcZGJGEhNGYOCee14U2KJoquAI4UB+hzahpcWOTqGKZr2/ltKk/aliKBTO/MUwTiXuGdDF+DtrfsMx/nh05CFUJJKsFODURfAdVkca3mVIh6alYpHmdTpjvsjg5mpS+L3Gbxkf6I0x51v3rp3mCgsP2a8Bolemc9snNAgMBAAECggEAKoOZpPT11iAB5NI8RgiohkL7jW8fpEuhh9nsUKZ4UBcXOzYRRaZstOLdUrgDfUhVS55DoBfdkLbVCIX358J/j/Cus16LgJmKcZAnH6L716Zlh8NnnBkEH7FttEzNC1K01blAkfqb/aKrteLoOJ9QKInAc0Vl3GquXnU9u4RDXSVZvnd5lKh9D5FSzarJmEZWvjh2WdTah4eEE9URhWlAiedBgB+oVRAj2pUUzl4fQJvOORgjz57GWH/FokyOoK+OzCXbw0P1WTflNt/a9nxc9yfoAAK0yTYgnwxGiu90tKCLu+nOUIqBHe9DokyyUzZOyjlwcysFiDctNqJu7bEUkwKBgQDTc7RH/LFdgdGCVWPkmrkjtCqsrVp9ag6rDJeqxcL0SI90j0Fvx047O7dnRqwA0UTGEZsvube2Y6ncjng1pGhPIDGJRvs2veIqXBNW05vKOhNoqFRbBxbeXqyxSuahWmT6xTOZA91AelQ/Ovk0Pc0ylkzPqEl5ewzd1vs3oazX5wKBgQDc8U6lcgLlFqE4ma961+vFGqcASRn2jKoNJOkRfqzMGoOowSCxXZfx8Rw/BXrRPcbclLjllVfWGaRCNIrM4grrUrhTxg7AUzyxl7I0kG8xKyPWF5ubaYyH5yXgD7RXZGLjsJbNAeFIynLSM1Vg1OGpL4F4InNt7Lux9EM78ZSKKwKBgGV8HMSIFSBJ1CH3la/8SmtGZ0zlDo8uvcd+jbRaogzYXnGU59UcFQH80TNyCc+CoL1nadHoErIo9zdx8WPdemqvitbWCG/nhorKEkYT3aubYAFU+NePeXxUeBHHXxWF6v0odHE2F5SAobqPNVfLaZaj6E2p+UmiszQtn/i9UdV1AoGAdkjCABUPs7Hv0iuFJNEgKj/glGiOe85G5A6UsIcO3556SghLBmnDBQY+RwcZ/5eBNWpxqofPpJHJvKAAhzuk+OMqR79K+nAVmEZMY5PH05zy7JVq+0MAt2lqf5Aoznix8JADy/FruNqZqitNVC/kN/105Oocvgb1XYoVzKvDCE0CgYEAjyeUggscnJVER60hAJXB6raUrrcde3awrJ+uOVuyeWSMhlS3XQbliyc68pcUFKKx+Rt3Ifscs3EAxezSXrRKObQShfxmWoM1Q7C6Sw9/T+YQ8zLv4ysbJeXUFL+ghu11DSa6V+2T4U1uJ83K0meQoS2zYcrsENXvI5BhGSudNnY="
WORKDIR /app

COPY --from=builder /app/target/*.jar app.jar

EXPOSE 8080

CMD ["java", "-jar", "/app/app.jar"]